<?xml version="1.0" encoding="UTF-8"?>
<project default="deploy-app" name="server-deployment" >
	<description>Jetty web deployment file</description>
	<target name="deploy-app">
		<mkdir dir="../jetty/logs"/>
		<copy file="./lib/derby.jar" todir="../jetty/lib/ext/"></copy>
		<copy file="./lib/derbyclient.jar" todir="../jetty/lib/ext/"></copy>
		<jar destfile="../jetty/lib/ext/common.jar" basedir="../common/bin"></jar>
		<jar destfile="../sierra-services/lib/web-dependencies/common.jar" basedir="../common/bin"></jar>
		<jar destfile="../sierra-services/lib/web-dependencies/sierra-jdbc.jar" basedir="../sierra-jdbc/bin"></jar>
		<jar destfile="../sierra-services/lib/web-dependencies/sierra-message.jar" basedir="../sierra-message/bin"></jar>		
		<war destfile="../jetty/webapps/sierra-services.war" webxml="../sierra-services/web.xml">
			<fileset dir="../sierra-services/www" />
			<classes dir="../sierra-services/bin" />
			<lib dir="../sierra-services/lib/web-dependencies" />
		</war>
		<jar destfile="../sierra-portal/lib/web-dependencies/sierra-jdbc.jar" basedir="../sierra-jdbc/bin"></jar>
		<jar destfile="../sierra-portal/lib/web-dependencies/sierra-message.jar" basedir="../sierra-message/bin"></jar>		
		<jar destfile="../sierra-portal/lib/web-dependencies/sierra-portal-rpc.jar" basedir="../sierra-portal-rpc/bin"></jar>
		<path id="gwt.class.path">
		 <pathelement path="${java.class.path}/"/>
		 <pathelement location="../sierra-portal/src"/>
		 <pathelement path="../sierra-portal/lib/gwt/gwt-user.jar"/>
		 <pathelement path="../sierra-portal/lib/gwt/gwt-dev-linux.jar"/>
		</path>
		<java classpathref="gwt.class.path" classname="com.google.gwt.dev.GWTCompiler" fork="true">
			<arg value="-out"/>
			<arg value="../sierra-portal/www"/>
			<arg value="com.surelogic.sierra.gwt.SierraPortal"/>
		</java>
		<war destfile="../jetty/webapps/sierra-portal.war" webxml="../sierra-portal/web.xml">
			<fileset dir="../sierra-portal/www/com.surelogic.sierra.gwt.SierraPortal" />
			<classes dir="../sierra-portal/bin" />
			<lib dir="../sierra-portal/lib/web-dependencies" />
		</war>
	</target>
</project>